<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
        <template id="wallet_assets_frontend" inherit_id="website.assets_frontend" name="Wallet Assets">
            <xpath expr="." position="inside">
                 <script src="/bi_internal_wallet/static/src/js/website_custom.js" type="text/javascript"></script>
            </xpath>
        </template>

        <template id="wallet_assets_for_pos" inherit_id="point_of_sale.assets">
            <xpath expr="." position="inside">
                <script type="text/javascript" src="/bi_internal_wallet/static/src/js/pos_custom.js"/>
            </xpath>
        </template>

        <template id="header_wallet" inherit_id="website.layout" name="Wallet">
            <xpath expr="//header//ul[@id='top_menu']/li" position="before">
                <t t-if="request.website.wallet_res_config() == True">
                    <!-- <li><a t-attf-href="/wallet" role="menuitem" sequence="1">Wallet</a></li> -->
                     <a class="nav-link" href="/wallet">Wallet</a>
                </t>      
          </xpath>
        </template>
        
        <!-- Wallet Page -->
        <template id="wallet_balance" name="Wallet Balance Page">
            <t t-call="website.layout">
                <section class="s_big_picture bg-primary">
                    <div class="container">
                        <form t-attf-action="/wallet/balance/confirm" method="post">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                                <div class="row">
                                    <div class="col-md-12 text-center mt32 mb32">
                                        <h2>Your Wallet Details</h2>
                                    </div>
                                    <div class="col-md-12 text-center">
                                      <img class="img img-responsive" src="/bi_internal_wallet/static/src/img/wallet-1.png"  alt="Odoo CMS - a big picture"/>
                                    </div>
                                    
                                    <t t-set="website_wallet" t-value="website.get_wallet_balance()"/>
                                        <t t-foreach="website_wallet" t-as="wallet">
                                        
                                        <div class="col-md-12 text-center mt32 mb32">
                                            <h2>You have <b> <span class="text-right"
                                                t-field="wallet.wallet_balance"
                                                t-field-options='{"widget": "monetary", "display_currency": "wallet.property_product_pricelist.currency_id"}'/> </b> wallet balance in your account.</h2>
                                        </div>
                                    </t>
                                    <div id='submit_wallet' class="col-md-12 text-center mt32 mb32">
                                    <a href="/add/wallet/balance" class="btn" style="height: 40px;background-color: #FDC00F;color: black;">Add Wallet Balance</a>
                                    </div>
                                </div>
                         </form>
                    </div>
                </section>
            </t>
        </template>     
        
        <!-- Add Wallet on Payment Page -->
        <template id="website_wallet_on_payment_page" inherit_id="website_sale.payment" active="True" customize_show="True" name="Show Website Wallet">

            <!-- Wallet Xpath -->
            <xpath expr="//div[@id='payment_method']" position="before">
                
                <t t-if="request.website.wallet_res_config() == True">
                    <div t-if="website_sale_order and website_sale_order.website_order_line" class="col-lg-12">
                        <div class="website-wallet">
                            <div class="checkbox" style="margin-left:19px">
                                <input type="checkbox" name="website_wallet" id="website_wallet"/>
                                <label style="font-size: 18px; cursor:auto; color: #337AB7; padding-left: 0px;"> Use Wallet </label>   
            
                            </div>
                            <div class="mb32"><b>Your Current Wallet Balance is </b> <span class="text-right" style="font-size: 18px; color: #337AB7; font-weight: 700;"
                                            t-field="website_sale_order.partner_id.wallet_balance"
                                            t-field-options='{"widget": "monetary", "display_currency": "order.pricelist_id.currency_id"}'/></div>
                        </div>
                    </div>
                </t>
                        
                
            </xpath>    
                            
        </template>
        
        <template id="add_wallet_balance">
        <t t-call="website.layout">

            <t t-set="additional_title">Add Wallet Balance</t>
            <div class="wrap">
                <div class="container o_website_payment">
                    <h1>Add Wallet Balance</h1>
                    <div id="wrap">
                        <div class="container oe_website_sale">
                            <form t-attf-action="/wallet/balance/confirm" method="post">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                                <div class="row">
                                    <div class="col-md-8 oe_cart">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div t-if="error_message" class="alert alert-danger">
                                                    <t t-foreach="error_message" t-as="err">
                                                        <t t-esc="err" />
                                                        <br />
                                                    </t>
                                                </div>
                                            </div>

                                            <br />
                                            <br />

                                            <div
                                                t-attf-class="form-group #{error and 'name' in error and 'has-error' or ''}">

                                                <label class="col-md-3 col-sm-4 control-label" for="name">Amount
                                                </label>
                                                <div class="col-md-7 col-sm-8">
                                                    <input type="text" class="form-control" name="amount"
                                                        required="True" />
                                                </div>
                                            </div>
                                            <br />
                                            <br />

                                            <button type="submit" id="add_wallet_payment"
                                        class="btn btn-primary pull-right">Add Wallet Balance</button>
                                        </div>

                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </t>

    </template>

    <template id="portal_my_home_wallet_transaction" name="Portal My Home : Wallet Transactions" inherit_id="portal.portal_my_home" priority="40">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
            <div class="o_portal_docs list-group">
                <t t-if="wallet_count" t-call="portal.portal_docs_entry">
                    <t t-set="title">Wallet Transactions</t>
                    <t t-set="url" t-value="'/my/wallet-transactions'"/>
                    <t t-set="count" t-value="wallet_count"/>
                </t>
            </div>
        </xpath>
    </template>
    
    <template id="portal_my_wallet_transactions" name="My Wallet Transactions">
      <t t-call="portal.portal_layout">
        <h3>Wallet Transactions
            <t t-call="portal.portal_searchbar"/>
        </h3>
        <t t-if="not wallets">
            <p>There are currently no Wallet Transaction for your account.</p>
        </t>
        <div t-if="wallets" class="panel panel-default">
            <div class="table-responsive"><table class="table table-hover o_portal_my_doc_table">
                <thead>
                  <tr class="active">
                      <th>Transaction Type</th>
                      <th>Customer</th>
                      <th>Sale Order</th>
                      <th>Amount</th>
                      <th>Currency</th>
                    </tr>
                </thead>
                <t t-foreach="wallets" t-as="wallet">
                    <t t-if='wallet.wallet_type == "debit"'>
                        <tr style='background-color:rgba(255, 0, 24, 0.37);'>
                            <td> <span t-field="wallet.wallet_type"/>
                            </td>
                            <td><span t-field="wallet.partner_id.name"/></td>
                            <td><span t-field="wallet.sale_order_id.name"/></td>
                            <td>
                                <span t-field="wallet.amount"/>
                            </td>
                            <td><span t-field="wallet.currency_id.name"/>
                            </td>
                        </tr>
                    </t>
                    
                    <t t-if='wallet.wallet_type == "credit"'>
                        <tr style='background-color:rgba(0, 128, 0, 0.34);'>
                            <td> <span t-field="wallet.wallet_type"/>
                            </td>
                            <td><span t-field="wallet.partner_id.name"/></td>
                            <td><span t-field="wallet.sale_order_id.name"/></td>
                            <td>
                                <span t-field="wallet.amount"/>
                            </td>
                            <td><span t-field="wallet.currency_id.name"/>
                            </td>
                        </tr>
                    </t>
                </t>
            </table></div>
            <div t-if="pager" class="o_portal_pager text-center">
              <t t-call="portal.pager"/>
            </div>
        </div>
      </t>
    </template>

    <template id="pay_wallet_conf" inherit_id="website_sale.payment_confirmation_status" name="Payment with Wallet">
        <xpath expr="div[hasclass('oe_website_sale_tx_status')]" position="replace">
            <t t-if='not order.get_portal_last_transaction()'>
                <div class="oe_website_sale_tx_status mt-3" t-att-data-order-id="order.id">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <div class="ml8"><span>Thank You for Confirming Order with Wallet</span></div>
                        </div>
                    </div>
                </div>
            </t>
            <t t-if='order.get_portal_last_transaction()'>
                <div class="oe_website_sale_tx_status mt-3" t-att-data-order-id="order.id">
                    <t t-set="payment_tx_id" t-value="order.get_portal_last_transaction()"/>
                    <div class="card">
                        <div t-att-class="'card-header %s' % (
                            (payment_tx_id.state == 'pending' and 'bg-info') or
                            (payment_tx_id.state == 'done' and 'bg-success') or
                            (payment_tx_id.state == 'authorized' and 'bg-success') or
                            'bg-danger')">
                            <a role="button" groups="base.group_system" class="btn btn-sm btn-link text-white float-right" target="_blank" aria-label="Edit" title="Edit"
                                    t-att-href="'/web#model=%s&amp;id=%s&amp;action=%s&amp;view_type=form' % ('payment.acquirer', payment_tx_id.acquirer_id.id, 'payment.action_payment_acquirer')">
                                <i class="fa fa-pencil"></i>
                            </a>
                            <t t-if="payment_tx_id.state == 'pending'">
                                <t t-raw="payment_tx_id.acquirer_id.pending_msg"/>
                            </t>
                            <t t-if="payment_tx_id.state == 'done'">
                                <t t-raw="payment_tx_id.acquirer_id.done_msg"/>
                            </t>
                            <t t-if="payment_tx_id.state == 'cancel'">
                                <t t-raw="payment_tx_id.acquirer_id.cancel_msg"/>
                            </t>
                            <t t-if="payment_tx_id.state == 'error'">
                                <span t-if="payment_tx_id.acquirer_id.error_msg" t-raw="payment_tx_id.acquirer_id.error_msg"/>
                                <span t-else="">An error occured while processing your payment. Please try again or contact your administrator.</span>
                            </t>
                            <t t-if="payment_tx_id.state == 'authorized'">
                                <span t-if="payment_tx_id.acquirer_id.auth_msg" t-raw="payment_tx_id.acquirer_id.auth_msg"/>
                                <span t-else="">Your payment has been authorized.</span>
                            </t>
                        </div>
                        <div t-if="payment_tx_id.acquirer_id.post_msg" t-att-class="'card-body %s' % (
                            (payment_tx_id.state == 'pending' and 'bg-info-light') or
                            (payment_tx_id.state == 'done' and 'bg-success-light') or
                            (payment_tx_id.state == 'authorized' and 'bg-success-light') or
                            'bg-danger-light')">
                            <t t-raw="payment_tx_id.acquirer_id.post_msg" />
                            <div t-if="payment_tx_id.acquirer_id.provider == 'transfer' and order.reference">
                                <b>Communication: </b><span t-esc='order.reference'/>
                            </div>
                        </div>
                        <div t-if="(payment_tx_id.acquirer_id.qr_code == True) and (payment_tx_id.acquirer_id.provider == 'transfer') and (payment_tx_id.partner_id.country_id.code in ['BE', 'AT', 'DE', 'FI', 'NL']) and (payment_tx_id.currency_id.name == 'EUR')">
                            <div class="card-body" t-if="payment_tx_id.acquirer_id.journal_id.bank_account_id.qr_code_valid">
                                <h3>Or scan me with your banking app.</h3>
                                <img class="border border-dark rounded" t-att-src="payment_tx_id.acquirer_id.journal_id.bank_account_id.build_qr_code_url(order.amount_total,payment_tx_id.reference)"/>
                            </div>
                            <div class="card-body" t-if="payment_tx_id.acquirer_id.journal_id.bank_account_id.qr_code_valid == False">
                                <h3>The SEPA QR Code informations are not set correctly.</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </xpath>
    </template>


</odoo>
